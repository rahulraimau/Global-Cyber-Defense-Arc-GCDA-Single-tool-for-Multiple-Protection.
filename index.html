<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GCDA Professional Dashboard</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: 'Roboto', sans-serif; display:flex; min-height:100vh; background:#f4f6f8; }
    .sidebar { width:220px; background:#1e2a38; color:white; display:flex; flex-direction:column; padding-top:20px; position:fixed; height:100%; }
    .sidebar h2 { text-align:center; margin-bottom:30px; font-size:1.5rem; }
    .sidebar a { padding:15px 20px; color:white; text-decoration:none; display:block; transition:0.3s; cursor:pointer; }
    .sidebar a:hover, .sidebar a.active { background:#0f75d1; }
    .main-content { margin-left:220px; padding:20px 30px; flex:1; }
    header { background:#1e90ff; color:white; padding:15px 20px; border-radius:8px; margin-bottom:20px; }
    section { background:white; padding:20px; border-radius:8px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.05); display:none; }
    section.active { display:block; }
    h3 { margin-bottom:15px; color:#1e2a38; }
    .card-container { display:flex; gap:20px; flex-wrap:wrap; }
    .card { background:#1e90ff; color:white; padding:20px; border-radius:8px; flex:1; min-width:150px; text-align:center; cursor:pointer; transition:0.3s; }
    .card:hover { background:#0f75d1; }
    table { width:100%; border-collapse: collapse; margin-top:15px; }
    table th, table td { border:1px solid #ddd; padding:8px; text-align:left; }
    table th { background:#1e90ff; color:white; }
    .severity-Low { color: green; font-weight:bold; }
    .severity-Medium { color: orange; font-weight:bold; }
    .severity-High { color: red; font-weight:bold; }
    .severity-Critical { color: darkred; font-weight:bold; }
    #notifications { max-height:150px; overflow-y:auto; margin-top:10px; border:1px solid #ddd; padding:10px; background:#fafafa; border-radius:5px; }
    .notification { margin-bottom:5px; padding:5px; border-radius:4px; font-weight:bold; }
    .notification.Low { background:#d4edda; color:#155724; }
    .notification.Medium { background:#fff3cd; color:#856404; }
    .notification.High { background:#f8d7da; color:#721c24; }
    .notification.Critical { background:#721c24; color:white; }
</style>
</head>
<body>

<div class="sidebar">
    <h2>GCDA</h2>
    <a class="active" onclick="showSection('dashboard')">Dashboard</a>
    <a onclick="showSection('siem')">SIEM Module</a>
    <a onclick="showSection('edr')">EDR/XDR Module</a>
    <a onclick="showSection('grc')">GRC Module</a>
    <a onclick="showSection('reports')">Reports</a>
    <a onclick="showSection('cyber')">Cyber Data Module</a>
    <a onclick="logout()">Logout</a>
</div>

<div class="main-content">
    <header><h1>Global Cyber Defense Arc</h1></header>

    <!-- Dashboard -->
    <section id="dashboard" class="active"><h3>Dashboard Overview</h3><canvas id="overviewChart" height="150"></canvas></section>

    <!-- SIEM -->
    <section id="siem">
        <h3>SIEM Module Logs</h3>
        <div class="card-container">
            <div class="card" onclick="alert('Running Real-Time SIEM Scan')">Run SIEM Scan</div>
            <div class="card" onclick="alert('Exporting SIEM Logs')">Export Logs</div>
        </div>
        <table>
            <thead><tr><th>Timestamp</th><th>Event</th><th>Severity</th></tr></thead>
            <tbody id="siemTable"></tbody>
        </table>
        <h4>Live Notifications</h4><div id="notifications"></div>
    </section>

    <!-- EDR -->
    <section id="edr">
        <h3>EDR/XDR Module</h3>
        <div class="card-container">
            <div class="card" onclick="alert('Running Endpoint Scan')">Scan Endpoint</div>
            <div class="card" onclick="alert('Quarantining Threats')">Quarantine Threats</div>
        </div>
        <canvas id="edrChart" height="150"></canvas>
    </section>

    <!-- GRC -->
    <section id="grc">
        <h3>GRC Module</h3>
        <div class="card-container">
            <div class="card" onclick="alert('Opening Risk Dashboard')">Risk Dashboard</div>
            <div class="card" onclick="alert('Checking Compliance')">Compliance Check</div>
            <div class="card" onclick="alert('Generating Policy Report')">Policy Report</div>
        </div>
    </section>

    <!-- Reports -->
    <section id="reports">
        <h3>Reports</h3>
        <button onclick="alert('Generating Overall GCDA Report')">Generate Report</button>
    </section>

    <!-- Cyber Data -->
    <section id="cyber">
        <h3>Cyber Data Overview</h3>
        <canvas id="cyberChart" height="150"></canvas>
        <table id="cyberTable">
            <thead>
                <tr><th>Protocol</th><th>Count</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

</div>

<script>
// ===== Authentication & Role-based Access =====
const token = localStorage.getItem('gcdaToken');
const role = localStorage.getItem('gcdaRole');

if (!token) {
    alert("Please login first!");
    window.location.href = "login.html";
}

function logout() {
    localStorage.removeItem('gcdaToken');
    localStorage.removeItem('gcdaRole');
    window.location.href = "login.html";
}

// Role-based sidebar
const grcLink = document.querySelector('a[onclick="showSection(\'grc\')"]');
const reportsLink = document.querySelector('a[onclick="showSection(\'reports\')"]');
const edrLink = document.querySelector('a[onclick="showSection(\'edr\')"]');

if(role === 'analyst'){
    if(grcLink) grcLink.style.display='none';
    if(reportsLink) reportsLink.style.display='none';
} else if(role==='auditor'){
    if(edrLink) edrLink.style.display='none';
}

// ===== Section Navigation =====
function showSection(sectionId){
    const sections=document.querySelectorAll('section');
    sections.forEach(s=>s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');

    const links=document.querySelectorAll('.sidebar a');
    links.forEach(link=>link.classList.remove('active'));
    event.target.classList.add('active');
}

// ===== SIEM Logs =====
const siemEvents=[
    {event:"Login Success",severity:"Low"},
    {event:"Failed SSH Attempt",severity:"High"},
    {event:"Malware Detected",severity:"Critical"},
    {event:"Unauthorized Access",severity:"High"},
    {event:"Firewall Alert",severity:"Medium"}
];

function updateSiemLogs(){
    const table=document.getElementById('siemTable');
    const notifications=document.getElementById('notifications');
    const now=new Date(); const timestamp=now.toLocaleTimeString();
    const randomEvent=siemEvents[Math.floor(Math.random()*siemEvents.length)];
    const row=`<tr><td>${timestamp}</td><td>${randomEvent.event}</td><td class="severity-${randomEvent.severity}">${randomEvent.severity}</td></tr>`;
    table.innerHTML=row+table.innerHTML;
    if(table.rows.length>10)table.deleteRow(-1);

    const notif=document.createElement('div');
    notif.className=`notification ${randomEvent.severity}`;
    notif.textContent=`[${timestamp}] ${randomEvent.event} - ${randomEvent.severity}`;
    notifications.prepend(notif);
    if(notifications.childNodes.length>5) notifications.removeChild(notifications.lastChild);
}

setInterval(updateSiemLogs,5000);
updateSiemLogs();

// ===== Overview Chart =====
const ctx=document.getElementById('overviewChart').getContext('2d');
const overviewChart=new Chart(ctx,{
    type:'line',
    data:{labels:Array(10).fill(''), datasets:[{label:'Security Events', data:Array(10).fill(0), borderColor:'#1e90ff', backgroundColor:'rgba(30,144,255,0.2)', fill:true, tension:0.3}]},
    options:{responsive:true, animation:false}
});
function updateOverviewChart(){
    const now=new Date().toLocaleTimeString();
    overviewChart.data.labels.push(now);
    overviewChart.data.labels.shift();
    overviewChart.data.datasets[0].data.push(Math.floor(Math.random()*20));
    overviewChart.data.datasets[0].data.shift();
    overviewChart.update();
}
setInterval(updateOverviewChart,5000);

// ===== EDR Chart =====
const ctxEdr=document.getElementById('edrChart').getContext('2d');
const edrChart=new Chart(ctxEdr,{
    type:'bar',
    data:{labels:['Endpoint1','Endpoint2','Endpoint3','Endpoint4'], datasets:[{label:'Threats Detected', data:[0,0,0,0], backgroundColor:'#1e90ff'}]},
    options:{responsive:true, animation:false}
});
function updateEdrChart(){
    edrChart.data.datasets[0].data=edrChart.data.datasets[0].data.map(()=>Math.floor(Math.random()*5));
    edrChart.update();
}
setInterval(updateEdrChart,5000);

// ===== Cyber Data Module =====
async function loadCyberData(){
    try{
        const res=await fetch('http://localhost:5000/api/cyber/stats',{headers:{'x-auth-token':token}});
        const data=await res.json();

        const tbody=document.querySelector('#cyberTable tbody');
        tbody.innerHTML='';
        for(const proto in data.protocolCount){
            const tr=document.createElement('tr');
            tr.innerHTML=`<td>${proto}</td><td>${data.protocolCount[proto]}</td>`;
            tbody.appendChild(tr);
        }

        const ctx=document.getElementById('cyberChart').getContext('2d');
        if(window.cyberChartInstance) window.cyberChartInstance.destroy();
        window.cyberChartInstance=new Chart(ctx,{
            type:'bar',
            data:{labels:Object.keys(data.protocolCount), datasets:[{label:'Protocol Count', data:Object.values(data.protocolCount), backgroundColor:'#1e90ff'}]},
            options:{responsive:true}
        });
    } catch(err){ console.log(err); alert("Failed to load cyber data"); }
}
setInterval(loadCyberData,10000);
loadCyberData();
</script>
</body>
</html>
